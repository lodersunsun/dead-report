<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>2025-07-09 死淘日报</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body { font-family: Arial, sans-serif; background: #f2f2f2; margin: 0; padding: 20px; }
        .container { max-width: 600px; margin: auto; background: #fff; padding: 20px; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
        h1 { color: #003087; font-size: 1.5rem; margin-bottom: 0.5em; }
        label { display: block; margin-top: 1em; font-weight: bold; }
        select, input[type="number"], input[type="text"] { width: 100%; padding: 10px; margin-top: 0.5em; border: 1px solid #ccc; border-radius: 5px; }
        button { margin-top: 1.5em; width: 100%; padding: 12px; background-color: #003087; color: white; border: none; border-radius: 5px; font-size: 1rem; }
        .record { margin-top: 2em; background: #f9f9f9; padding: 10px; border-left: 5px solid #003087; }
        .positive { color: green; }
        .negative { color: red; }
    </style>
</head>
<body>
<div class="container">
    <h1 id="title">2025-07-09 死淘日报</h1>
    <p id="timestamp"></p>

    <label for="house">选择栋号：</label>
    <select id="house">
        <option value="1栋">1栋</option><option value="2栋">2栋</option><option value="3栋">3栋</option><option value="4栋">4栋</option><option value="5栋">5栋</option><option value="6栋">6栋</option><option value="7栋">7栋</option><option value="8栋">8栋</option><option value="9栋">9栋</option><option value="10栋">10栋</option><option value="11栋">11栋</option><option value="12栋">12栋</option><option value="13栋">13栋</option><option value="14栋">14栋</option><option value="15栋">15栋</option><option value="16栋">16栋</option>
    </select>

    <label for="today">今日死淘数：</label>
    <input type="number" id="today" placeholder="请输入死淘数">

    <label>环比变化：</label>
    <p id="changeDisplay">-</p>

    <label for="status">栋状态：</label>
    <input type="text" id="status" placeholder="如：换羽、转群">

    <label for="note">备注：</label>
    <input type="text" id="note" placeholder="如：免疫第3天">

    <button onclick="submitData()">确认提交</button>

    <div class="record">
        <h3>已提交数据：</h3>
        <div id="recordList"></div>
    </div>
</div>

<script>
    const yesterdayData = {
        "1栋": 97, "2栋": 51, "3栋": 46, "4栋": 51
    };

    const timestampEl = document.getElementById("timestamp");
    const houseEl = document.getElementById("house");
    const todayEl = document.getElementById("today");
    const changeDisplay = document.getElementById("changeDisplay");
    const statusEl = document.getElementById("status");
    const noteEl = document.getElementById("note");
    const recordList = document.getElementById("recordList");

    function updateTime() {
        const now = new Date();
        const timeStr = now.toLocaleTimeString("en-US", { hour: "2-digit", minute: "2-digit" }) + " JST, " + now.toLocaleDateString("en-US", { year: 'numeric', month: 'long', day: 'numeric' });
        timestampEl.textContent = "数据录入时间：" + timeStr;
    }

    function calculateChange() {
        const house = houseEl.value;
        const todayVal = parseInt(todayEl.value) || 0;
        const yesterday = yesterdayData[house] || 0;
        const diff = todayVal - yesterday;
        changeDisplay.textContent = (diff >= 0 ? "+" : "") + diff;
        changeDisplay.className = diff > 0 ? 'positive' : (diff < 0 ? 'negative' : '');
        return diff;
    }

    function submitData() {
        const house = houseEl.value;
        const todayVal = parseInt(todayEl.value);
        if (isNaN(todayVal)) {
            alert("请输入今日死淘数");
            return;
        }
        const change = calculateChange();
        const status = statusEl.value;
        const note = noteEl.value;
        const now = new Date();
        const timeStr = now.toLocaleTimeString("en-US", { hour: "2-digit", minute: "2-digit" }) + " JST";

        const data = {
            house, today: todayVal, change, status, note, time: timeStr
        };

        const key = "2025-07-09_data";
        let all = JSON.parse(localStorage.getItem(key)) || [];
        all.push(data);
        localStorage.setItem(key, JSON.stringify(all));
        showRecords();
        todayEl.value = '';
        statusEl.value = '';
        noteEl.value = '';
    }

    function showRecords() {
        const key = "2025-07-09_data";
        const all = JSON.parse(localStorage.getItem(key)) || [];
        recordList.innerHTML = all.map(d => `
            <p><strong>${d.house}</strong> 死淘：${d.today}，环比：<span class="${d.change > 0 ? 'positive' : (d.change < 0 ? 'negative' : '')}">${d.change >= 0 ? '+' : ''}{d.change}</span>，状态：${d.status}，备注：${d.note}，时间：${d.time}</p>
        `).join('');
    }

    updateTime();
    showRecords();
    todayEl.addEventListener("input", calculateChange);
    houseEl.addEventListener("change", calculateChange);
</script>
</body>
</html>
